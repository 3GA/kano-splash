#!/bin/sh

# kano-launcher
#
# Copyright (C) 2014 Kano Computing Ltd.
# License: http://www.gnu.org/licenses/gpl-2.0.txt GNU General Public License v2
#
# A simple script to launch Kano projects
# Usage: kano-launcher cmd [preset]

# Make sure there are no other projects running at the same time
killall_projects () {
    killall -q python
    killall -q ruby
    killall -q scsynth
    killall -q minecraft-pi
    killall -q make-minecraft
    killall -q splash.py
    killall -q make-pong
    killall -q make-music
    killall -q make-video
    killall -q make-snake
}


if [ "$2" != "pcmanfm" ]; then
    killall_projects
fi

if [ -z "$1" ]; then
    exit 1
fi

# Show a splash if the app is configured to do so.
SPLASH=/usr/bin/kano-splash
CMDNAME=$2
if test -z "$2" ; then
    CMDNAME=$(basename $1)
fi
SPLASH_PNG=/usr/share/$CMDNAME/splash.png

if test -e $SPLASH_PNG ;  then
    $SPLASH $SPLASH_PNG &
	SPLASH_PID=$!
	SPLASH_START_TIME=$(kano-get-start-time $SPLASH_PID)
	export SPLASH_PID SPLASH_START_TIME
	
fi
eval "$1 &"

# Apply window presets
case "$2" in
    make-snake)
        kano-window-tool -t "Make Snake" -dyes -m -f
        ;;
    pcmanfm)
        if [ -e /usr/bin/kano-profile-cli ]; then
            kano-profile-cli increment_app_state_variable pcmanfm starts 1
        fi
        ;;
esac

exit 0
