#!/usr/bin/env python

# kano-dispmanx-launch
#
# Copyright (C) 2016 Kano Computing Ltd.
# License: http://www.gnu.org/licenses/gpl-2.0.txt GNU General Public License v2
#
# Allow dispmanx apps to launch each other without overlapping.
# We run the first command, then scan its output for lines like
# TO_LAUNCH:cmd
# These are queued to run next.
#
# Usage: kano-dispmanx-launch cmd
# Example: kano-dispmanx-launch "/usr/bin/love-0.10 /usr/bin/kanoOverworld.love"

import subprocess
import sys

# Queue ofcommands to launch
to_launch = [sys.argv[1]]

launch_prefix = "TO_LAUNCH:"

while to_launch:
   cmd = to_launch.pop(0)
   out = subprocess.check_output(cmd, shell=True).split('\n')
   for line in out:
      print line # copy to stdout
      if line.startswith(launch_prefix):
         cmd = line[len(launch_prefix):]
         to_launch.append(cmd)
