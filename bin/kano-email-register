#!/usr/bin/env python

# kano-email-register
#
# Copyright (C) 2013 Kano Computing Ltd.
# License:   http://www.gnu.org/licenses/gpl-2.0.txt GNU General Public License v2
#
# Argument 1: email
# Argument 2: user name
# Argument 3: RPi ID
#

import requests
import sys
import time

# Check for the correct number of parameters
if len(sys.argv) != 4:
    print "Error: incorrect parameters [email] [username] [RPi ID]"
    sys.exit(1)

# Details of the Google form
url = "https://docs.google.com/a/kano.me/forms/d/1rYyIH4OG_sCmgSAr12iOX5tPRLL_dthLZEtZOkyFIeg/formResponse"
entryEmail = "entry.1842334521"
email = sys.argv[1]
entryName = "entry.1313297301"
name = sys.argv[2]
entryId = "entry.812659153"
id_split = sys.argv[3].split(":")
if len(id_split) == 1:
    sys.exit('arg[3] cannot be split!')
id = id_split[1]

info = {entryEmail: email, entryName: name, entryId: id}

# Create a post request with the information gathered
numTries = 3
while numTries > 0:
    r = requests.post(url, data=info)
    if r.status_code == 200:
        break
    numTries -= 1
    time.sleep(1)

sys.exit(0)
